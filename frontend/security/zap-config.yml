env:
  contexts:
    - name: AuthContext
      urls:
        - "http://localhost:8080"
      authentication:
        method: json
        parameters:
          loginRequestUrl: "http://localhost:8080/api/auth/login"
          loginRequestBody: '{"username":"${TEST_USERNAME}","password":"${TEST_PASSWORD}"}'
          loginRequestHeaders: "Content-Type: application/json"
        verification:
          method: response
          loggedInRegex: '"token":".*"'
      sessionManagement:
        method: headers
        parameters:
          Authorization: "Bearer {%json:token%}"
      users:
        - name: testUser
          credentials:
            username: "${TEST_USERNAME}"
            password: "${TEST_PASSWORD}"
  vars:
    target_base: "http://localhost:8080"
    api_spec_url: "${target_base}/v3/api-docs"
  parameters:
    failOnError: true
    progressToStdout: true

jobs:
  - name: import-openapi
    type: openapi
    parameters:
      context: AuthContext
      user: testUser
      apiUrl: "${api_spec_url}"
      targetUrl: "${target_base}"

  - name: passiveScanWait
    type: passiveScan-wait
    parameters:
      maxDuration: 5

  - name: activeScan
    type: activeScan
    parameters:
      context: AuthContext
      user: testUser
      policy: "Default Policy"
      maxScanDurationInMins: 10

  - name: report-high-level
    type: report
    parameters:
      template: high-level-report
      reportDir: zap-reports
      reportFile: zap-report-high-level.html

  - name: report-modern
    type: report
    parameters:
      template: modern
      reportDir: zap-reports
      reportFile: zap-report-modern.html

  - name: report-risk-confidence
    type: report
    parameters:
      template: risk-confidence-html
      reportDir: zap-reports
      reportFile: zap-report-risk-confidence.html

  - name: report-traditional
    type: report
    parameters:
      template: traditional-html
      reportDir: zap-reports
      reportFile: zap-report-traditional.html

  - name: report-traditional-plus
    type: report
    parameters:
      template: traditional-html-plus
      reportDir: zap-reports
      reportFile: zap-report-traditional-plus.html
